{"version":3,"file":"player.js","sources":["store/module/player.js"],"sourcesContent":["import { defineStore } from 'pinia' \r\nimport { fetchSongDetail, fetchSongLyric, fetchSongProxyUrl } from '@/service/module/plyaer'\nimport { formatLyrics } from '@/utils/formatView'\nimport { fetchSearchSinger, fetchSingerSongs } from '../../service/module/search'\r\nimport { audioInstance } from '../../utils/audioInstance'\n\r\nconst audioContext = audioInstance()\nconst usePlayer = defineStore('player', {\r\n\tstate: () => {\r\n\t\treturn {\r\n\t\t\tisFirstPlay: true,\r\n\t\t\tsongDetail: {},\r\n\t\t\tsongList: [],\r\n\t\t\tsingerId: 0,\r\n\t\t\tsingerDetail: {},\r\n\t\t\tsongIndex: 0,\r\n\t\t\tlyrics: \"\",\r\n\t\t\tlyricsList: {},\r\n\t\t\tcurrentIndex: -1,\r\n\t\t\tcurrentLyrics: \"\",\r\n\t\t\tcurrentTime: 0,\r\n\t\t\tdurationTime: 0,\r\n\t\t\tsliderLength: 0,\r\n\t\t\tscrollToTop: 0,\r\n\t\t\tisSlide: false,\r\n\t\t\tisPlaying: true,\r\n\t\t\tisShow: false,\r\n\t\t\tcurrentOrder: 0,\r\n\t\t\ttimerActive: 0,\r\n\t\t\tcurrentOrderName: \"order\",\r\n\t\t}\r\n\t},\r\n\tactions: {\r\n\t\tgetSongs(id) {\r\n\t\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 获取歌曲详情\r\n\t\t\t\t\tlet res = await fetchSongDetail(id)\r\n\t\t\t\t\tthis.songDetail = res.data.songs[0]\r\n\t\t\t\t\tthis.durationTime = res.data.songs[0].dt\r\n\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\tthis.singerId = res.data.songs[0].ar[0].id\r\n\t\t\t\t\t// 获取歌词\r\n\t\t\t\t\tres = await fetchSongLyric(id)\r\n\t\t\t\t\tthis.lyrics = res.data.lrc.lyric\r\n\t\t\t\t\tthis.lyricsList = formatLyrics(this.lyrics)\r\n\t\t\t\t\tresolve()\r\n\t\t\t\t} catch(err) {\r\n\t\t\t\t\treject(err)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t//获取歌曲&播放\r\n\t\tasync playSong(id) {\r\n\t\t\tthis.isPlaying = true\r\n\t\t\tconst proxyRes = await fetchSongProxyUrl(id)\r\n\t\t\ttry {\r\n\t\t\t\tif(proxyRes.data.code !== 200) {\r\n\t\t\t\t\tthrow new Error(`HTTP error! status`);\r\n\t\t\t\t\treturn\r\n\t\t\t\t} \r\n\t\t\t\tconst proxyUrl = proxyRes.data.data.url\r\n\t\t\t\taudioContext.src = proxyUrl\r\n\t\t\t} catch(error) {\r\n\t\t\t\tconsole.log('报错',error);\r\n\t\t\t\tconsole.log('启动非代理url');\r\n\t\t\t\taudioContext.src = `https://music.163.com/song/media/outer/url?id=${id}.mp3`\r\n\t\t\t}\r\n\t\t\tawait this.getSongs(id)\r\n\t\t\tthis.isShow = true\r\n\t\t\taudioContext.stop()\r\n\t\t\taudioContext.autoplay = true\r\n\t\t\taudioContext.play()\r\n\t\t},\r\n\t\tgetSearchSingerInfo() {\r\n\t\t\treturn new Promise(async (resolve) => {\r\n\t\t\t\tconst res = await fetchSearchSinger(this.singerId)\r\n\t\t\t\tthis.singerDetail = res.data.data\r\n\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t},\r\n\t\tgetSingerSongs() {\r\n\t\t\treturn new Promise(async (resolve) => {\r\n\t\t\t\tconst res = await fetchSingerSongs(this.singerId)\r\n\t\t\t\tresolve(res.data.hotSongs)\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n})\r\nexport default usePlayer"],"names":["audioInstance","defineStore","fetchSongDetail","uni","fetchSongLyric","formatLyrics","fetchSongProxyUrl","fetchSearchSinger","fetchSingerSongs"],"mappings":";;;;;;AAMA,MAAM,eAAeA,oBAAAA,cAAe;AAC/B,MAAC,YAAYC,cAAW,YAAC,UAAU;AAAA,EACvC,OAAO,MAAM;AACZ,WAAO;AAAA,MACN,aAAa;AAAA,MACb,YAAY,CAAE;AAAA,MACd,UAAU,CAAE;AAAA,MACZ,UAAU;AAAA,MACV,cAAc,CAAE;AAAA,MAChB,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,YAAY,CAAE;AAAA,MACd,cAAc;AAAA,MACd,eAAe;AAAA,MACf,aAAa;AAAA,MACb,cAAc;AAAA,MACd,cAAc;AAAA,MACd,aAAa;AAAA,MACb,SAAS;AAAA,MACT,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,cAAc;AAAA,MACd,aAAa;AAAA,MACb,kBAAkB;AAAA,IAClB;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACR,SAAS,IAAI;AACZ,aAAO,IAAI,QAAQ,OAAO,SAAS,WAAW;AAC7C,YAAI;AAEH,cAAI,MAAM,MAAMC,sBAAe,gBAAC,EAAE;AAClC,eAAK,aAAa,IAAI,KAAK,MAAM,CAAC;AAClC,eAAK,eAAe,IAAI,KAAK,MAAM,CAAC,EAAE;AACtCC,2EAAY,IAAI,IAAI;AACpB,eAAK,WAAW,IAAI,KAAK,MAAM,CAAC,EAAE,GAAG,CAAC,EAAE;AAExC,gBAAM,MAAMC,sBAAc,eAAC,EAAE;AAC7B,eAAK,SAAS,IAAI,KAAK,IAAI;AAC3B,eAAK,aAAaC,8BAAa,KAAK,MAAM;AAC1C,kBAAS;AAAA,QACT,SAAO,KAAK;AACZ,iBAAO,GAAG;AAAA,QACV;AAAA,MACL,CAAI;AAAA,IACD;AAAA;AAAA,IAED,MAAM,SAAS,IAAI;AAClB,WAAK,YAAY;AACjB,YAAM,WAAW,MAAMC,sBAAiB,kBAAC,EAAE;AAC3C,UAAI;AACH,YAAG,SAAS,KAAK,SAAS,KAAK;AAC9B,gBAAM,IAAI,MAAM,oBAAoB;AACpC;AAAA,QACA;AACD,cAAM,WAAW,SAAS,KAAK,KAAK;AACpC,qBAAa,MAAM;AAAA,MACnB,SAAO,OAAO;AACdH,sBAAY,MAAA,MAAA,OAAA,gCAAA,MAAK,KAAK;AACtBA,sBAAAA,MAAY,MAAA,OAAA,gCAAA,UAAU;AACtB,qBAAa,MAAM,iDAAiD,EAAE;AAAA,MACtE;AACD,YAAM,KAAK,SAAS,EAAE;AACtB,WAAK,SAAS;AACd,mBAAa,KAAM;AACnB,mBAAa,WAAW;AACxB,mBAAa,KAAM;AAAA,IACnB;AAAA,IACD,sBAAsB;AACrB,aAAO,IAAI,QAAQ,OAAO,YAAY;AACrC,cAAM,MAAM,MAAMI,wCAAkB,KAAK,QAAQ;AACjD,aAAK,eAAe,IAAI,KAAK;AAC7B,gBAAS;AAAA,MACb,CAAI;AAAA,IACD;AAAA,IACD,iBAAiB;AAChB,aAAO,IAAI,QAAQ,OAAO,YAAY;AACrC,cAAM,MAAM,MAAMC,uCAAiB,KAAK,QAAQ;AAChD,gBAAQ,IAAI,KAAK,QAAQ;AAAA,MAC7B,CAAI;AAAA,IACD;AAAA,EACD;AACF,CAAC;;"}